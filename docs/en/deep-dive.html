<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Deep-Dive</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#deep-dive">1. Deep-Dive</a>
<ul class="sectlevel2">
<li><a href="#representation-of-a-credential-record">1.1. Representation of a credential record</a></li>
<li><a href="#credentialrecord-serialization-and-deserialization">1.2. CredentialRecord serialization and deserialization</a></li>
<li><a href="#dcappledevice-serialization-and-deserialization">1.3. DCAppleDevice serialization and deserialization</a></li>
<li><a href="#alternative-to-unsupported-json-serialization-apis-in-safari">1.4. Alternative to Unsupported JSON Serialization APIs in Safari</a></li>
<li><a href="#modules">1.5. Modules</a></li>
<li><a href="#origin-verification">1.6. Origin verification</a></li>
<li><a href="#custom-validator-implementation">1.7. Custom validator implementation</a></li>
<li><a href="#custom-converter-implementation">1.8. Custom converter implementation</a></li>
<li><a href="#classes">1.9. Classes</a></li>
<li><a href="#using-fido-ctap2-security-key-in-your-own-application-other-than-webauthn">1.10. Using FIDO CTAP2 Security key in your own application other than WebAuthn</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="deep-dive"><a class="anchor" href="#deep-dive"></a>1. Deep-Dive</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="representation-of-a-credential-record"><a class="anchor" href="#representation-of-a-credential-record"></a>1.1. Representation of a credential record</h3>
<div class="paragraph">
<p>WebAuthn4j provides <code>CredentialRecord</code> interface as a representation of a credential record.</p>
</div>
<div class="paragraph">
<p>On registering the credential, you need to persist its representation by creating the instance implementing
<code>CredentialRecord</code> interface in your application manner because it is used afterwards on authentication verification.
It might be better to use credentialId as a search key for this persisted instance.</p>
</div>
<div class="paragraph">
<p>You can freely enhance the class implementing <code>CredentialRecord</code> interface in order to meet your application&#8217;s requirements.
For example, you can add a field like <code>name</code> to identify the credential.</p>
</div>
</div>
<div class="sect2">
<h3 id="credentialrecord-serialization-and-deserialization"><a class="anchor" href="#credentialrecord-serialization-and-deserialization"></a>1.2. CredentialRecord serialization and deserialization</h3>
<div class="paragraph">
<p>While it is application&#8217;s responsibility to serialize <code>CredentialRecord</code> instance at registration, WebAuthn4J provides an utility class to serialize or deserialize fields of <code>CredentialRecord</code> class.
Please use them for implementing persistence in your application.</p>
</div>
<div class="sect3">
<h4 id="attestedcredentialdata"><a class="anchor" href="#attestedcredentialdata"></a>1.2.1. attestedCredentialData</h4>
<div class="paragraph">
<p><code>AttestedCredentialDataConverter</code> converts from <code>AttestedCredentialData</code> to <code>byte[]</code> and vice versa.
If you would like to persist as <code>String</code>, use <code>Base64UrlUtil</code> to convert from <code>byte[]</code> to base64url <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">AttestedCredentialDataConverter attestedCredentialDataConverter = new AttestedCredentialDataConverter(objectConverter);

// serialize
byte[] serialized = attestedCredentialDataConverter.convert(attestedCredentialData);
// deserialize
AttestedCredentialData deserialized = attestedCredentialDataConverter.convert(serialized);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="attestationstatement"><a class="anchor" href="#attestationstatement"></a>1.2.2. attestationStatement</h4>
<div class="paragraph">
<p>Since <code>AttestationStatement</code> is an interface, there are some implementation classes like <code>PackedAttestationStatement</code> or <code>AndroidKeyAttestationStatement</code> per format.
As <code>AttestationStatement</code> is not self-descriptive for its format, the format need to be persisted in an another field.
Because of that, an envelope class which has attestationStatement field and format field is required, and the envelope class need to be serialized for persisting <code>AttestationStatement</code>.
Since the envelope class itself is not provided by the WebAuthn4J library, please implement your own envelope class on the application side, referring to the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">//serialize
AttestationStatementEnvelope envelope = new AttestationStatementEnvelope(attestationStatement);
byte[] serializedEnvelope = objectConverter.getCborConverter().writeValueAsBytes(envelope);

//deserialize
AttestationStatementEnvelope deserializedEnvelope = objectConverter.getCborConverter().readValue(serializedEnvelope, AttestationStatementEnvelope.class);
AttestationStatement deserializedAttestationStatement = deserializedEnvelope.getAttestationStatement();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">class AttestationStatementEnvelope{

    @JsonProperty("attStmt")
    @JsonTypeInfo(
            use = JsonTypeInfo.Id.NAME,
            include = JsonTypeInfo.As.EXTERNAL_PROPERTY,
            property = "fmt"
    )
    private AttestationStatement attestationStatement;

    @JsonCreator
    public AttestationStatementEnvelope(@JsonProperty("attStmt") AttestationStatement attestationStatement) {
        this.attestationStatement = attestationStatement;
    }

    @JsonProperty("fmt")
    public String getFormat() {
        return attestationStatement.getFormat();
    }

    public AttestationStatement getAttestationStatement() {
        return attestationStatement;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transports"><a class="anchor" href="#transports"></a>1.2.3. transports</h4>
<div class="paragraph">
<p>If you would like to persist as JSON <code>String</code>, use <code>ObjectConverter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">String serializedTransports = objectConverter.getJsonConverter().writeValueAsString(transports);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="counter"><a class="anchor" href="#counter"></a>1.2.4. counter</h4>
<div class="paragraph">
<p>This member is <code>long</code>.
Nothing special is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="authenticatorextensions"><a class="anchor" href="#authenticatorextensions"></a>1.2.5. authenticatorExtensions</h4>
<div class="paragraph">
<p>This member can be serialized as CBOR bytes array as it is originally CBOR data.
If you would like to persist as <code>String</code>, use <code>Base64UrlUtil</code> to convert from <code>byte[]</code> to base64url <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">byte[] serializedAuthenticatorExtensions = objectConverter.getCborConverter().writeValueAsBytes(authenticatorExtensions);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="clientextensions"><a class="anchor" href="#clientextensions"></a>1.2.6. clientExtensions</h4>
<div class="paragraph">
<p>This member can be serialized as JSON as it is originally JSON data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">String serializedClientExtensions = objectConverter.getJsonConverter().writeValueAsString(clientExtensions);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dcappledevice-serialization-and-deserialization"><a class="anchor" href="#dcappledevice-serialization-and-deserialization"></a>1.3. DCAppleDevice serialization and deserialization</h3>
<div class="paragraph">
<p>When you use <code>webauthn4j-appattest</code>, you need to persist <code>DCAppleDevice</code> instead of <code>CredentialRecord</code> interface between attestation and assertion.
In general, you can serialize and deserialize it by the method explained in <a href="#credentialrecord-serialization-and-deserialization">CredentialRecord serialization and deserialization</a>, but <code>ObjectConverter</code> must be the one with <code>DeviceCheckCBORModule</code> registered.
A <code>ObjectConverter</code> with a <code>DeviceCheckCBORModule</code> can be obtained with <code>DeviceCheckManager.createObjectConverter</code> static method.</p>
</div>
</div>
<div class="sect2">
<h3 id="alternative-to-unsupported-json-serialization-apis-in-safari"><a class="anchor" href="#alternative-to-unsupported-json-serialization-apis-in-safari"></a>1.4. Alternative to Unsupported JSON Serialization APIs in Safari</h3>
<div class="paragraph">
<p>In the Quick Start, <code>PublicKeyCredential.parseCreationOptionsFromJSON</code> is introduced as an API for parsing <code>PublicKeyCredentialCreationOptions</code>, and <code>PublicKeyCredential#toJSON</code> as an API for serializing <code>PublicKeyCredential</code>. However, these APIs are not available on Safari versions earlier than 18.4.</p>
</div>
<div class="paragraph">
<p>As an alternative, it is recommended to use the pony-fill provided by the npm library <a href="https://github.com/github/webauthn-json">github/@webauthn-json</a>, maintained by GitHub.
It provides <code>parseCreationOptionsFromJSON</code> method as a substitute for <code>PublicKeyCredential.parseCreationOptionsFromJSON</code> and <code>create</code> as a substitute for <code>navigator.credentials.create</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example 1: github/@webauthn-json: Creating a credential</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">import {
  create,
  parseCreationOptionsFromJSON,
} from "@github/webauthn-json/browser-ponyfill";

const response = await fetch("&lt;endpoint path that returns PublicKeyCredentialCreationOptions as JSON&gt;") //fetch PublicKeyCredentialCreationOptions as JSON string
const publicKeyCredentialCreationOptionsJSON = await response.json() // convert to JSONObject
const credentialCreationOptions = parseCreationOptionsFromJSON(publicKeyCredentialCreationOptionsJSON); // convert to PublicKeyCredentialCreationOptions
const publicKeyCredential = await create({ publicKey: credentialCreationOptions}); // create PublicKeyCredential
const registrationResponseJSON = publicKeyCredential.toJSON() // JSON object of publicKeyCredential
const registrationResponseJSONStr = JSON.stringify(registrationResponseJSON) // JSON string representation of publicKeyCredential</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>toJSON</code> method can be used on the publicKeyCredential obtained using the <code>create</code> method of this pony-fill.</p>
</div>
<div class="paragraph">
<p>It also provides <code>parseRequestOptionsFromJSON</code> as a substitute for <code>PublicKeyCredential.parseRequestOptionsFromJSON</code>, and <code>get</code> is provided as a substitute for <code>navigator.credentials.get</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example 2: github/@webauthn-json: Getting a credential</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="javascript">import {
  get,
  parseRequestOptionsFromJSON,
} from "@github/webauthn-json/browser-ponyfill";

const response = await fetch("&lt;endpoint path that returns PublicKeyCredentialRequestOptions as JSON&gt;");
const publicKeyCredentialRequestOptionsJSON = await response.json();
const credentialGetOptions = parseRequestOptionsFromJSON(publicKeyCredentialRequestOptionsJSON);
const publicKeyCredential = await get({ publicKey: credentialGetOptions });
const authenticationResponseJSON = publicKeyCredential.toJSON();
const authenticationResponseJSONStr = JSON.stringify(authenticationResponseJSON);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modules"><a class="anchor" href="#modules"></a>1.5. Modules</h3>
<div class="paragraph">
<p>WebAuthn4J consists of the following four modules.</p>
</div>
<div class="sect3">
<h4 id="core-webauthn4j-core-jar"><a class="anchor" href="#core-webauthn4j-core-jar"></a>1.5.1. Core: webauthn4j-core.jar</h4>
<div class="paragraph">
<p>Provides core features for WebAuthn attestation and assertion verification.</p>
</div>
</div>
<div class="sect3">
<h4 id="metadata-webauthn4j-metadata-jar"><a class="anchor" href="#metadata-webauthn4j-metadata-jar"></a>1.5.2. Metadata: webauthn4j-metadata.jar</h4>
<div class="paragraph">
<p>Provides additional features regarding FIDO Metadata Service.</p>
</div>
</div>
<div class="sect3">
<h4 id="core-async-webauthn4j-core-async-jar"><a class="anchor" href="#core-async-webauthn4j-core-async-jar"></a>1.5.3. Core-Async: webauthn4j-core-async.jar</h4>
<div class="paragraph">
<p>Provides async variant of core features for WebAuthn attestation and assertion verification.</p>
</div>
</div>
<div class="sect3">
<h4 id="metadata-async-webauthn4j-metadata-async-jar"><a class="anchor" href="#metadata-async-webauthn4j-metadata-async-jar"></a>1.5.4. Metadata-Async: webauthn4j-metadata-async.jar</h4>
<div class="paragraph">
<p>Provides async variant of additional features regarding FIDO Metadata Service.</p>
</div>
</div>
<div class="sect3">
<h4 id="app-attest-webauthn4j-appattest-jar"><a class="anchor" href="#app-attest-webauthn4j-appattest-jar"></a>1.5.5. App Attest: webauthn4j-appattest.jar</h4>
<div class="paragraph">
<p>Provides core features for Apple App Attest attestation and assertion verification.</p>
</div>
</div>
<div class="sect3">
<h4 id="test-webauthn4j-test-jar"><a class="anchor" href="#test-webauthn4j-test-jar"></a>1.5.6. Test: webauthn4j-test.jar</h4>
<div class="paragraph">
<p>Internal library for WebAuthn4J testing.
The included classes don&#8217;t follow semantic versioning and the design may be changed even though it is public.</p>
</div>
</div>
<div class="sect3">
<h4 id="util-webauthn4j-util-jar"><a class="anchor" href="#util-webauthn4j-util-jar"></a>1.5.7. Util: webauthn4j-util.jar</h4>
<div class="paragraph">
<p>Contains utility classes used in WebAuthn4J library.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="origin-verification"><a class="anchor" href="#origin-verification"></a>1.6. Origin verification</h3>
<div class="paragraph">
<p>In WebAuthn, “Origin verification” means the server verifies that the Origin recognized by the user agent (browser) at the time of the registration or authentication ceremony matches the Origin expected by the RP.
This verification relies on the origin recorded in clientData and ensures the ceremony actually started from the intended page, preventing phishing and unintended cross‑origin invocation.</p>
</div>
<div class="paragraph">
<p>By default, WebAuthn does not allow cross‑origin usage within iframes (e.g., executing WebAuthn inside an iframe whose parent page is on a different origin).
This is to uphold the same‑origin policy and mitigate threats such as clickjacking, or forcing authentication from another origin.</p>
</div>
<div class="paragraph">
<p>That said, there are legitimate use cases where you may want to allow cross‑origin execution in a constrained manner: Embedding an authentication widget in a partner site (different parent and RP origins).</p>
</div>
<div class="paragraph">
<p>In such cases, you should both declare permission to the client side via Permissions‑Policy directives and also configure server‑side verification appropriately.
WebAuthn4J provides a ServerProperty builder API to declare acceptable origins for the RP page, and additionally to constrain acceptable top origins (the top‑level document/parent page).
By default, cross‑origin usage is not allowed; you must explicitly opt in by configuring acceptable top origins.</p>
</div>
<div class="sect3">
<h4 id="origin-verification-2"><a class="anchor" href="#origin-verification-2"></a>1.6.1. origin verification</h4>
<div class="ulist">
<ul>
<li>
<p>How to specify</p>
<div class="ulist">
<ul>
<li>
<p>origin(&#8230;&#8203;), origins(&#8230;&#8203;), originPredicate(&#8230;&#8203;): Specify the acceptable origin(s) for the RP page.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Default behavior</p>
<div class="ulist">
<ul>
<li>
<p>Only requests whose clientData.origin matches the specified condition are accepted.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ServerProperty serverProperty = ServerProperty.builder()
    .origin(new Origin("https://rp.example.com"))
    .rpId("rp.example.com")
    .challenge(challenge)
    .build();</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="toporigin-verification"><a class="anchor" href="#toporigin-verification"></a>1.6.2. topOrigin verification</h4>
<div class="ulist">
<ul>
<li>
<p>Purpose</p>
<div class="ulist">
<ul>
<li>
<p>When running WebAuthn in an iframe, verify the top‑level document’s origin (the parent page) and allow the ceremony only when it is framed by the expected parent.</p>
</li>
</ul>
</div>
</li>
<li>
<p>How to specify</p>
<div class="ulist">
<ul>
<li>
<p>topOrigin(&#8230;&#8203;), topOrigins(&#8230;&#8203;), topOriginPredicate(&#8230;&#8203;): Allow only the specified top origins</p>
</li>
<li>
<p>anyTopOrigin(): Allow any top origin (convenient, but expands the security boundary and should be used with care)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Default behavior</p>
<div class="ulist">
<ul>
<li>
<p>If you do not configure a topOriginPredicate, cross‑origin iframe usage is not allowed.</p>
</li>
<li>
<p>If the client does not provide topOrigin, only the normal origin verification is performed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example (allow a specific parent origin)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ServerProperty serverProperty = ServerProperty.builder()
    .origin(new Origin("https://rp.example.com"))
    .rpId("rp.example.com")
    .challenge(challenge)
    .topOrigin(new Origin("https://parent.example.com"))
    .build();</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Example (allow any parent origin — not recommended for production)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ServerProperty serverProperty = ServerProperty.builder()
    .origin(new Origin("https://rp.example.com"))
    .rpId("rp.example.com")
    .challenge(challenge)
    .anyTopOrigin()
    .build();</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Security considerations</p>
<div class="ulist">
<ul>
<li>
<p>anyTopOrigin significantly increases the attack surface. Prefer whitelisting specific parent origins with topOrigin/topOrigins/topOriginPredicate wherever possible.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Backward compatibility</p>
<div class="ulist">
<ul>
<li>
<p>Legacy coarse‑grained allow flags may remain for compatibility, but for new setups use topOriginPredicate (or anyTopOrigin where strictly necessary). The client’s crossOrigin value is a supplemental signal; the final allow/deny decision should be made by the server‑side topOrigin configuration.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-validator-implementation"><a class="anchor" href="#custom-validator-implementation"></a>1.7. Custom validator implementation</h3>
<div class="paragraph">
<p>WebAuthn4J can add custom validator.
For registration validation, implement <code>CustomRegistrationVerifier</code>.
For authentication validation, implement <code>CustomAuthenticationVerifier</code>.</p>
</div>
<div class="sect3">
<h4 id="custom-validator-registration"><a class="anchor" href="#custom-validator-registration"></a>1.7.1. Custom validator registration</h4>
<div class="paragraph">
<p><code>CustomRegistrationVerifier</code> and <code>CustomAuthenticationVerifier</code> implementation can be registered to <code>WebAuthnManager</code>
via its constructor&#8217;s <code>customRegistrationVerifiers</code> and <code>customAuthenticationVerifiers</code> parameters.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-converter-implementation"><a class="anchor" href="#custom-converter-implementation"></a>1.8. Custom converter implementation</h3>
<div class="paragraph">
<p>WebAuthn4J uses Jackson library for JSON and CBOR serialization and deserialization.
If you would like to custom serialization or deserialization, register custom serializer or deserializer to the underlying Jackson <code>ObjectMapper</code>.</p>
</div>
<div class="sect3">
<h4 id="custom-converter-registration"><a class="anchor" href="#custom-converter-registration"></a>1.8.1. Custom converter registration</h4>
<div class="paragraph">
<p>Since WebAuthn4J wraps <code>ObjectMapper</code> with <code>ObjectConverter</code>, inject your customized <code>ObjectMapper</code> through <code>ObjectConverter</code>
constructor and specify the <code>ObjectConverter</code> instance to the <code>WebAuthnManager</code> instance creation parameter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="classes"><a class="anchor" href="#classes"></a>1.9. Classes</h3>
<div class="sect3">
<h4 id="data-transfer-objects"><a class="anchor" href="#data-transfer-objects"></a>1.9.1. Data Transfer Objects</h4>
<div class="paragraph">
<p>Classes under <code>com.webauthn4j.data</code> package are designed as immutable DTO.</p>
</div>
</div>
<div class="sect3">
<h4 id="converter-jackson-modules-for-webauthn"><a class="anchor" href="#converter-jackson-modules-for-webauthn"></a>1.9.2. Converter, Jackson Modules for WebAuthn</h4>
<div class="paragraph">
<p>Classes under <code>com.webauthn4j.data</code> package are designed as being serializable and deserializable.</p>
</div>
<div class="paragraph">
<p>Some Classes under <code>converter</code> package needs custom serializer and deserializer.
Jackson&#8217;s module named
<code>WebAuthnJSONModule</code> and <code>WebAuthnCBORModule</code> consolidate these custom serializer and deserializer.
WebAuthn4J’s validators register these modules onto Jackson&#8217;s <code>ObjectMapper</code> automatically.</p>
</div>
<div class="paragraph">
<p>If you want to use WebAuthn4J’s serializer and deserializer outside of WebAuthnManager, you can register these modules onto Jackson&#8217;s <code>ObjectMapper</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="trustanchorsresolver"><a class="anchor" href="#trustanchorsresolver"></a>1.9.3. TrustAnchorsResolver</h4>
<div class="paragraph">
<p><code>TrustAnchorsResolver</code> interface is used by <code>TrustAnchorCertPathTrustworthinessVerifier</code> to explore root certificates in the verification of the authenticity of the attestation statements.</p>
</div>
</div>
<div class="sect3">
<h4 id="trustanchorsprovider"><a class="anchor" href="#trustanchorsprovider"></a>1.9.4. TrustAnchorsProvider</h4>
<div class="paragraph">
<p><code>TrustAnchorsProvider</code> is an interface that <code>TrustAnchorsResolverImpl</code> delegates TrustAnchor load operation to.
KeyStoreFileTrustAnchorsProvider is provided as an implementation for loading TrustAnchor from Java Key Store file.
WebAuthn$J Spring Security also provides <code>CertFileResourcesTrustAnchorProvider</code> to load TrustAnchor from Spring Resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="exceptions"><a class="anchor" href="#exceptions"></a>1.9.5. Exceptions</h4>
<div class="paragraph">
<p>If some verification fails, WebAuthn4J throws an exception class inheriting <code>VerificationException</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-fido-ctap2-security-key-in-your-own-application-other-than-webauthn"><a class="anchor" href="#using-fido-ctap2-security-key-in-your-own-application-other-than-webauthn"></a>1.10. Using FIDO CTAP2 Security key in your own application other than WebAuthn</h3>
<div class="paragraph">
<p>For FIDO CTAP2 Security key, WebAuthn is just an application.
An original application can use a a security key too.
This section describes how to use WebAuthn4J for attestation and assertion validation in your own application using the FIDO CTAP2 security key.</p>
</div>
<div class="sect3">
<h4 id="registration-authentication-flow-of-your-own-application-using-fido-ctap2-security-key"><a class="anchor" href="#registration-authentication-flow-of-your-own-application-using-fido-ctap2-security-key"></a>1.10.1. Registration &amp; Authentication flow of your own application using FIDO CTAP2 security key</h4>
<div class="paragraph">
<p>If you use FIDO CTAP2 security key for authentication in your own application, you need to register the security key first.
Call the <a href="https://fidoalliance.org/specs/fido2/fido-client-to-authenticator-protocol-v2.1-rd-20191217.html#authenticatorMakeCredential">authenticatorMakeCredential</a> method of the security key to retrieve the "Attestation" data, which contains public key and device configuration and save it.
The obtained attestation data need to be verified to determine if the security key is acceptable for the application.
WebAuthn4J can verify the attestation with <code>CoreRegistrationVerifier</code> class.
For authentication, the application need to call the  <a href="https://fidoalliance.org/specs/fido2/fido-client-to-authenticator-protocol-v2.1-rd-20191217.html#authenticatorGetAssertion">authenticatorGetAssertion</a> method of the security key to retrieve the "assertion" data, which contains signature.
By validating the retrieved assertion, the application can determine whether the security key used for authentication is the same as the one used for registration, and can determine whether the access is legitimate.
WebAuthn4J can verify the assertion with <code>CoreAuthenticationVerifier</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-verify-application-specific-client-data"><a class="anchor" href="#how-to-verify-application-specific-client-data"></a>1.10.2. How to verify application specific client data</h4>
<div class="paragraph">
<p>Implementing the above flow will provide authentication feature, but if the entity that calls the FIDO CTAP2 security key (client) and the entity that verifies the attestation and the assertion are separated, in some cases, an application specific client data is needed to be verified at the server at registration and authentication.
The client data itself can be sent together with the attestation and assertion, but in order to protect the client data from MITM attacks, it need to be signed and protected.
In FIDO CTAP2 specification, there is a parameter named <code>clientDataHash</code> that is common to <a href="https://fidoalliance.org/specs/fido2/fido-client-to-authenticator-protocol-v2.1-rd-20191217.html#authenticatorMakeCredential">authenticatorMakeCredential</a> method used at registration and <a href="https://fidoalliance.org/specs/fido2/fido-client-to-authenticator-protocol-v2.1-rd-20191217.html#authenticatorGetAssertion">authenticatorGetAssertion</a> method used at authentication.
Since the security key generates a signature from data that contains <code>clientDataHash</code>, an application can verify its specific client data by setting <code>clientDataHash</code> to the hash of the client data and validating the signature.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.30.1-SNAPSHOT<br>
Last updated 2025-11-01 13:54:40 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>